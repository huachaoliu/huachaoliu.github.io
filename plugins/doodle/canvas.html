<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>test canvas</title>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        canvas{
            border: 1px solid #d3d3d3;
        }
    </style>
    <script src="js/doodle.js"></script>
    <script src="js/draw.js"></script>
</head>

<body>
    <canvas id="canvas" width="1024" height="500">
        your browser does not support the html5 canvas tag.
    <canvas>
    <script>
        var canvas = new doodle.Canvas('canvas', {});
        // var canvas = document.getElementById('canvas');
        var downLeft = 0;
        var downTop = 0;
        var moveState = false;
        canvas.onmousedown = function (e) {
                downLeft = e.pageX;
                downTop = e.pageY;
                drawRectEvent(e);
                moveState = false;
            document.onmousemove = function (e) {
                moveState = true;
                drawRectEvent(e);
                // drawTrangle(e);
            };
            document.onmouseup = function () {
                document.onmousemove = null;
                document.onmouseup = null;
                rect = null;
            }
        }
        var rect = null;
        function drawRectEvent(e) {
            if (rect) {
                // canvas.removeChild(rect);
                var ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                // canvas.remove(rect);
            }
            if (moveState) {
                var x = e.pageX,
                    y = e.pageY,
                    disX = x - downLeft,
                    disY = y - downTop;
                rect = new doodle.Rect(canvas, {
                    left: downLeft,
                    top: downTop,
                    width: disX,
                    height: disY
                });
                canvas.add(rect);
                console.log(canvas.children.item);       
            }
        }
        var circle = null;
        function drawCircle(e) {
            if (circle) {
                var ctx = canvas.getContext('2d');
                var x = e.pageX,
                    y = e.pageY,
                    disX = x - downLeft,
                    disY = y - downTop,
                    radius = Math.sqrt(x * x + y * y);
                clearArc(x+disX, y+disY,radius,ctx);
            }
            if (moveState) {
                var x = e.pageX,
                    y = e.pageY,
                    disX = x - downLeft,
                    disY = y - downTop,
                    radius = Math.sqrt(x * x + y * y);
                circle = new Canvas.Circle(canvas, {
                    left: downLeft,
                    top: downTop,
                    radius: radius,
                    disX: disX,
                    disY: disY,
                    x: x,
                    y: y
                });
            }
        }
        var stepClear = 1;
        function clearArc(x, y, r, ctx){
            var w = r - stepClear;
            var h = Math.sqrt(r*r - w*w);
            var posx = x - w;
            var posy = y - h;

            var wx = 2 * w;
            var hy = 2 * h;
            if (stepClear <= r) {
                ctx.clearRect(posx, posy, wx, hy, ctx);
                stepClear += 1;
                clearArc(x, y, r, ctx);
            }
        }
        var trangle = null;
        function drawTrangle(e) {
            if (trangle) {

            }
            if (moveState) {
                var x = e.pageX,
                    y = e.pageY,
                    disX = x - downLeft,
                    disY = y - downTop;
                rect = new doodle.Trangle(canvas, {
                    left: downLeft,
                    top: downTop,
                });
                // canvas.add(rect);
            }

        }
    </script>
</body>

</html>