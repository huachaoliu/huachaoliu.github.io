<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>涂鸦</title>
    <script src="js/jquery.js"></script>
    <script src="js/html2canvas.js"></script>    
    <script src="js/color.js"></script>
    <script src="js/colorpicker.js"></script>
    <script src="js/fabric.js"></script>
    <script src="js/doodle.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        .viewer{
            width:100%;
            height: 98vh;
            position: relative;
            /*margin: 0 auto;
            border-left: 1px solid;
            border-right: 1px solid;*/
        }
        .swap, .getImg {
            width: 60px;
            height: 30px;
            position: fixed;
            left: 10px;
            top: 10px;
            color: #fff;
            background: #15bbec;
            border-radius: 5px;
            text-align: center;
            line-height: 30px;
            cursor: pointer;
            z-index: 110;
            user-select: none;
            font-size: 12px;
        }
        .getImg {
            left: 80px;
        }

        .swap:active, .getImg:active {
            background: #005b75;
            box-shadow: 0 0 10px #15bbec;
        }

        .imageviewer {
            width: 300px;
            height: 200px;
            background: #fff;
            position: absolute;
            top: 50px;
            left: 10px;
            box-shadow: 0 5px 15px #999;
            z-index: 110;
        }

        img {
            width: 100%;
            /*height: 90%;*/
            margin-top: 3%;
        }
    </style>
</head>

<body>
    <div id="viewer" class="viewer">
        <div class="swap">开启涂鸦</div>
        <div id="getimage" class="getImg">生成图片</div>
        <div id="imageviewer" class="imageviewer">
            <img id="viewpoint" src="" alt="">
        </div>
    </div>
    <script>
        var count = 0;
        var openDoodleState = false;
        var viewer = document.getElementById('viewer');
        var doodle = new Doodle(viewer, {
            showMarkToggle: false,
            type: 'pdf',
            width: viewer.offsetWidth,
            height: viewer.offsetHeight
        });

        $('.swap').click(function () {
            count++;
            setTimeout(function () {
                if (count % 2 == 1) {
                    $('.swap').text('开启涂鸦');
                    openDoodleState = true;
                    doodle.setBtnToolState(true);
                } else {
                    $('.swap').text('关闭涂鸦');
                    doodle.clear();
                    openDoodleState = false;                    
                    doodle.setBtnToolState(false);
                }
            }, 10);
        })

        $('#getimage').click(function () {
            if (openDoodleState) {
                doodle.generateImage(document.getElementById('markupCanvasAnchor'), function (data) {
                    $('#viewpoint').attr('src', data.img);
                });
            }
        })
    </script>
</body>

</html>